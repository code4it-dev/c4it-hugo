---
title: "Top 5 String Performance Tips"
date: 2023-12-15T11:48:29+01:00
url: /blog/post-slug
draft: false
categories:
 - Blog
tags:
 - CSharp
toc: true
summary: "A summary"
images:
 - /blog/post-slug/featuredImage.png
---

Sometimes, just a minor change makes a huge difference. Maybe you won't notice it when performing the operation a few times, but the improvement is significant when repeating the operation thousands of time.

In this article, we will learn five simple tricks to improve the performance of your application when dealing with strings.

Note: this article is part of [C# Advent Calendar 2023](https://csadvent.christmas/), organized by [Matthew D. Groves](https://twitter.com/mgroves): it's maybe the only Christmas tradition I like (yes, I'm kinda of a Grinch üòÇ).

## Solution setup

Before jumping to the benchmarks, I want to spend a few words on the tools I used for this article.

### Run benchmarks with BenchmarkDotNet

I'm using **BenchmarkDotNet** to create benchmarks of my code. BenchmarkDotNet is a library that runs your methods several times, captures some metrics, and generates a report of the executions. If you follow my blog, you might know that I've used it several times - for example, in my old article [Enum.HasFlag performance with BenchmarkDotNet](https://www.code4it.dev/blog/hasflag-performance-benchmarkdotnet/).

All the benchmarks I created follow the same structure:

```cs
[MemoryDiagnoser]
[Config(typeof(CsvConfig))]
public class BenchmarkName()
{
    [Params(1, 5, 10)]
    public int Size;

    public string[] AllStrings { get; set; }

    [IterationSetup]
    public void Setup()
    {
        AllStrings = StringArrayGenerator.Generate(Size, "hello!", "HELLO!");
    }

    [Benchmark]
    public void FirstMethod()
    {
        //omitted
    }

    [Benchmark]
    public void SecondMethod()
    {
        //omitted
    }
}
```

In short:

- the class is marked with the `[MemoryDiagnoser]` attribute: the benchmark will retrieve info for both time and memory usage;
- the class has the `[Config(typeof(CsvConfig))]` attribute: this attribute adds some custom configurations (see below) that help generating plots and diagrams;
- there is a property named `Size` with the attribute `[Params(1, 5, 10)]`: the `Params` attribute lists the possible values for the `Size` property;
- there is a method marked as `[IterationSetup]`: this method runs before every single execution, takes the value from the `Size` property, and initializes the `AllStrings` array;
- the methods that will be benchmarked are marked with the `[Benchmark]` attribute.

### Generating strings with Bogus

To generate dummy values I relied on **Bogus**: this library allows you to generate realistic values for your objects, with a great level of customizations.

The string array generation strategy is shared across all the benchmarks, so I moved it in a static method:

```cs
 public static class StringArrayGenerator
 {
     public static string[] Generate(int size, params string[] additionalStrings)
     {
         string[] array = new string[size];
         Faker faker = new Faker();

         List<string> fixedValues = [
             string.Empty,
             "   ",
             "\n  \t",
             null
         ];

         if (additionalStrings != null)
             fixedValues.AddRange(additionalStrings);

         for (int i = 0; i < array.Length; i++)
         {
             if (Random.Shared.Next() % 4 == 0)
             {
                 array[i] = Random.Shared.GetItems<string>(fixedValues.ToArray(), 1).First();
             }
             else
             {
                 array[i] = faker.Lorem.Word();
             }
         }

         return array;
     }
 }
```

Here I have a default set of predefined values (`[string.Empty, "   ", "\n  \t", null]`), which can be expanded with the values coming from the `additionalStrings` array, which are placed in random positions of the array.

In most cases, though, the value of the string is defined by Bogus.

### Generating plots with R and chartbenchmark.net

To generate the plots you will see in this article I relied on two methods.

The easiest one was using [chartbenchmark.net](https://chartbenchmark.net/): it's a fantastic tool created by [Carlos Villegas](https://github.com/yv989c) that transforms the output generated by BenchmarkDotNet on console in a dynamic, customizable plot.

The other approach was using [R](https://cran.r-project.org/bin/windows/base/), a framework to generate graphics and computations. It was quite complicated to make it run, but the steps are:

1. download R from the official website (yes, I know, the website does not look fancy...);
2. install it, and store somewhere the installation path (for me, *C:\Users\d.bellone\AppData\Local\Programs\R\R-4.3.2* );
3. set the enviroment variable on Windows. For some reasons, I couldn't edit the values, so I came up with the next steps;
4. run the benchmarks
5. open the *BenchmarkDotNet.Artifact* folder under the *bin* of your project. For me it's under *\bin\Release\net8.0\BenchmarkDotNet.Artifacts*. You should see some `.log` files;
6. ensure that in the *result* subfolder you have some CSV files and, more important, a file named `BuildPlots.R`;
7. open a terminal in the *results* folder, and run this command: `C:\Users\d.bellone\AppData\Local\Programs\R\R-4.3.2\bin\RScript.exe ./BuildPlots.R`;

Now you should see lots of PNG files with the rendering of the results.

**Who generates those CSV**? If you remember from before, we customized every benchmark with the `[Config(typeof(CsvConfig))]` attribute. This attribute generates both the CSV and the R files, and is defined like this:

```cs
 public class CsvConfig : ManualConfig
 {
     public CsvConfig()
     {
         Add(CsvMeasurementsExporter.Default);
         Add(RPlotExporter.Default);
     }
 }
```

We are ready. **It's time to run some benchmarks!**


## StringBuilder vs Concatenation

## EndsWith string vs char

## IsNullOrEmpty vs IsNullOrEmpty + Trim vs IsNullOrWhitespace

## OrdinalIgnoreCase vs InvariantCultureIgnoreCase 

## Newtonsoft vs System.Json

## Further readings

_This article first appeared on [Code4IT üêß](https://www.code4it.dev/)_


## Wrapping up


I hope you enjoyed this article! Let's keep in touch on [Twitter](https://twitter.com/BelloneDavide) or [LinkedIn](https://www.linkedin.com/in/BelloneDavide/)! ü§úü§õ

Happy coding!

üêß


[ ] Titoli
[ ] Frontmatter
[ ] Rinomina immagini
[ ] Alt Text per immagini
[ ] Grammatica
[ ] Bold/Italics
[ ] Nome cartella e slug devono combaciare
[ ] Immagine di copertina
[ ] Rimuovi secrets dalle immagini
[ ] Pulizia formattazione
[ ] Controlla se ASP.NET Core oppure .NET
[ ] Metti la giusta OgTitle
[ ] Fai resize della immagine di copertina